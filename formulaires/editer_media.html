<div class="formulaire_spip formulaire_editer formulaire_editer_media">
[<p class="reponse_formulaire reponse_formulaire_ok text-center">(#ENV*{message_ok})</p>]
[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
[(#ENV{editable})
<form method="post" action="#ENV{action}" enctype="multipart/form-data"><div>
#ACTION_FORMULAIRE{#ENV{action}}
<input type="hidden" name="id_article" value="#ENV{id_article}" />
<input type="hidden" name="id_gis" value="#ENV{id_gis}" />
<div class="editer-groupe">
[(#ENV{_etape}|=={1}|oui)
	[(#SAISIE_FICHIER{bigup,media,
		obligatoire=oui,
		previsualiser=oui})]
]
[(#ENV{_etape}|=={2}|oui)
	<INCLURE{fond=formulaires/editer_media_previsu,id_article}>

	<div class="fieldset"><fieldset>
		[(#SAISIE{input,titre,
			obligatoire=oui,
			label=<:info_titre|label_nettoyer:>})]

		[(#SAISIE{textarea,texte,
			label=<:info_texte:>,
			inserer_barre=forum,
			rows=10})]

		[(#SAISIE{carte,gis,
			inserer_debut=<label><:geol:localisation:></label>[<span class='erreur_message'>(#ENV**{erreurs}|table_valeur{gis})</span>],
			nodraw=oui,
			noimport=oui,
			env})]

		[(#SAISIE{input,lat,
			obligatoire=oui,
			label=<:gis:lat:>})]

		[(#SAISIE{input,lon,
			obligatoire=oui,
			label=<:gis:lon:>})]

		[(#SAISIE{hidden,zoom,
			label=<:gis:zoom:>,
			size=2,
			maxlength=2})]

		[(#SAISIE{licences,licence,
			label=<:licence:cfg_titre_licence:>,
			valeur_forcee=#ENV{id_licence},
			cacher_option_intro=oui})]
	</fieldset></div>
]
</div>
<!--extra-->
<p class="boutons"><input class="submit" type="submit" value="[(#ENV{_etape}|<{#ENV{_etapes}}|?{<:bouton_suivant:>,<:bouton_enregistrer:>})]" /></p>
</div></form>
<script type="text/javascript">
;(function($){
	$('.formulaire_editer_media input.bigup').bigup({}, {
		fileSubmitted: function(event, file){
			// vérifier le quota d'upload
			$.ajax({
				url: '#URL_PAGE{geol_upload_limit}',
				async: false,
				type: 'GET',
				data: ({id_article: '#ENV{id_article}'}),
				dataType: 'html',
				success: function(msg){
					if (parseInt(msg) >= 1) {
						file.bigup.presenter_erreur(file.emplacement, _T('bigup:erreur_probleme_survenu'));
						file.bigup.enlever_fichier(file.emplacement);
					}
				}
			});
		},
		complete: function(){
			// autosubmit du formulaire après upload
			$('.formulaire_editer_media form').submit();
		}
	});
})(jQuery);
</script>]
</div>